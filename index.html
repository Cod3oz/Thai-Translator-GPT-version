<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>English to Thai Translator (GPT)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="manifest" href="manifest.json">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js");
    }
  </script>
  <style>
    .gender-icon { display:inline-block; width:1.5em; height:1.5em; vertical-align:middle; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-100 to-blue-50 flex items-center justify-center p-6">
  <div class="w-full max-w-3xl bg-white shadow-2xl rounded-2xl p-8">
    <h1 class="text-4xl font-bold text-center mb-8 text-blue-700">English → Thai Translator</h1>
    <div class="mb-6">
      <label class="block mb-2 font-semibold">English Text</label>
      <textarea id="input-text" class="w-full p-4 border rounded-xl focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
    </div>
    <div class="mb-6">
      <label class="block mb-2 font-semibold">Context</label>
      <select id="context-dropdown" class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500 mb-2">
        <option value="">None</option>
        <option value="formal">Formal</option>
        <option value="casual">Casual</option>
        <option value="playful">Playful</option>
        <option value="flirtatious">Flirtatious</option>
      </select>
      <textarea id="context-text" class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500" rows="2"></textarea>
    </div>
    <div class="mb-6">
      <label class="block mb-2 font-semibold">Model</label>
      <select id="model" class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500">
        <option value="gpt-4o-mini" selected>GPT-4o-mini</option>
        <option value="gpt-4o">GPT-4o</option>
        <option value="gpt-3.5-turbo">GPT-3.5-turbo</option>
      </select>
    </div>
    <div class="mb-8">
      <label class="block mb-2 font-semibold">Polite Gender</label>
      <select id="gender" class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500">
        <option value="both" selected>Both</option>
        <option value="male">Male only</option>
        <option value="female">Female only</option>
      </select>
    </div>
    <div class="text-center mb-8">
      <button id="translate-button" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-lg shadow">Translate</button>
    </div>
    <div id="translations-container" class="hidden">
      <h2 class="text-2xl font-bold mb-4 text-gray-800">Translations</h2>
      <div id="translations-list" class="space-y-6"></div>
      <div class="mt-10 p-4 border-t text-sm text-gray-600">
        <p class="font-semibold mb-2">Notes:</p>
        <ul class="list-disc pl-6 space-y-1 mb-4">
          <li>Casual: friendly, everyday language.</li>
          <li>Polite (Male/Female): respectful, ends with ครับ / ค่ะ.</li>
          <li>Formal: professional, very respectful.</li>
          <li>Playful: light, joking, informal.</li>
          <li>Flirtatious: romantic, teasing.</li>
        </ul>
        <div class="flex items-center space-x-6">
          <div class="flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" class="gender-icon"><circle cx="32" cy="32" r="20" fill="#FFE0BD"/><path d="M12 32c0-12 8-24 20-24s20 12 20 24v12H12V32z" fill="#000000"/></svg>
            <span>Polite (Male)</span>
          </div>
          <div class="flex items-center space-x-2">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" class="gender-icon"><circle cx="32" cy="32" r="20" fill="#FFE0BD"/><path d="M12 32c0-12 8-24 20-24s20 12 20 24v12H12V32z" fill="#FFD700"/></svg>
            <span>Polite (Female)</span>
          </div>
        </div>
      </div>
    </div>
    <div id="error-message" class="hidden text-red-600 mt-4"></div>
  </div>
<script>
const inputTextarea=document.getElementById('input-text');
const contextTextarea=document.getElementById('context-text');
const contextDropdown=document.getElementById('context-dropdown');
const translateButton=document.getElementById('translate-button');
const translationsContainer=document.getElementById('translations-container');
const translationsList=document.getElementById('translations-list');
const errorMessageDiv=document.getElementById('error-message');
const modelSelect=document.getElementById('model');
const genderSelect=document.getElementById('gender');
const maleSVG=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" class="gender-icon"><circle cx="32" cy="32" r="20" fill="#FFE0BD"/><path d="M12 32c0-12 8-24 20-24s20 12 20 24v12H12V32z" fill="#000000"/></svg>`;
const femaleSVG=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" class="gender-icon"><circle cx="32" cy="32" r="20" fill="#FFE0BD"/><path d="M12 32c0-12 8-24 20-24s20 12 20 24v12H12V32z" fill="#FFD700"/></svg>`;
async function handleTranslate(){
  const inputText=inputTextarea.value.trim();
  const contextText=contextTextarea.value.trim();
  const contextDropdownVal=contextDropdown.value.trim();
  const model=modelSelect.value;
  const gender=genderSelect.value;
  const combinedContext=[contextDropdownVal,contextText].filter(Boolean).join(", ");
  if(!inputText){showError("Please enter some text.");return;}
  hideError();translationsList.innerHTML="";translationsContainer.classList.add("hidden");
  try{
    const response=await fetch("/api/translate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:inputText,context:combinedContext,model,gender})});
    if(!response.ok)throw new Error("Proxy failed");
    const data=await response.json();
    if(!Array.isArray(data))throw new Error("Unexpected response");
    for(const r of data){
      let icon="";
      if(r.gender==="male")icon=maleSVG+" ";
      if(r.gender==="female")icon=femaleSVG+" ";
      const div=document.createElement("div");
      div.className="p-6 border rounded-xl bg-gray-50 shadow-sm";
      div.innerHTML=`<p class="font-bold text-blue-600 mb-1">${icon}${r.tone}</p>
        <p class="text-xl mb-1">${r.thai}</p>
        <p class="text-sm text-gray-600 mb-1">Pronunciation: ${r.romanization}</p>
        <p class="text-sm text-gray-600 mb-1">English: ${r.english}</p>
        <p class="text-sm text-gray-600">Explanation: ${r.explanation}</p>`;
      translationsList.appendChild(div);
    }
    translationsContainer.classList.remove("hidden");
  }catch(err){console.error(err);showError("Failed to get translations. Check Netlify setup.");}
}
function showError(msg){errorMessageDiv.textContent=msg;errorMessageDiv.classList.remove("hidden");}
function hideError(){errorMessageDiv.classList.add("hidden");}
translateButton.addEventListener("click",handleTranslate);
</script>
</body>
</html>